/*
 * 파일명: Program.cs (HarmonyAnalyzer)
 * 분류: [Tool] 어셈블리 분석기
 * 역할: 지정된 DLL 파일을 리플렉션하여 공개 클래스와 메서드 시그니처를 C# 코드 형태로 추출합니다.
 */

using System;
using System.Reflection;
using System.Linq;
using System.Text;

class Program
{
    static void Main(string[] args)
    {
        string dllPath = "Assets/harmony_source/0Harmony_BaseGame.dll";
        if (args.Length > 0) dllPath = args[0];
        try
        {
            Assembly asm = Assembly.LoadFrom(dllPath);
            Console.WriteLine($"// Decompiled API of: {asm.FullName}");
            Console.WriteLine($"// Location: {dllPath}");
            Console.WriteLine("// Generated by QudKR Analyzer");
            Console.WriteLine();

            foreach (Type type in asm.GetTypes().OrderBy(t => t.FullName))
            {
                if (!type.IsPublic) continue;

                Console.WriteLine($"public class {type.FullName}");
                Console.WriteLine("{");

                foreach (var method in type.GetMethods(BindingFlags.Public | BindingFlags.Instance | BindingFlags.Static | BindingFlags.DeclaredOnly))
                {
                    string staticPrefix = method.IsStatic ? "static " : "";
                    string returnType = method.ReturnType.Name;
                    string parameters = string.Join(", ", method.GetParameters().Select(p => $"{p.ParameterType.Name} {p.Name}"));
                    
                    Console.WriteLine($"    public {staticPrefix}{returnType} {method.Name}({parameters});");
                }

                Console.WriteLine("}");
                Console.WriteLine();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"// Error loading assembly: {ex.Message}");
        }
    }
}
