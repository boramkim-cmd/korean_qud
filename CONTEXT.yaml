# ============================================================================
# üß† Caves of Qud Korean Localization - AI Context (Vectorized)
# ============================================================================
# This file provides structured project context for AI assistants.
# Auto-updated by: python3 tools/session_manager.py save
# Last Updated: 2026-01-22
# ============================================================================

# ============================================================================
# PROJECT IDENTITY
# ============================================================================
project:
  name: Caves of Qud Korean Localization
  type: unity_mod
  game: Caves of Qud
  language: C# (Unity)
  framework: Harmony 2.x (Runtime Patching)
  purpose: Translate game UI/content to Korean
  repo: https://github.com/boramkim-cmd/korean_qud

# ============================================================================
# ARCHITECTURE (How the mod works)
# ============================================================================
architecture:
  entry_point: Scripts/00_Core/00_00_00_ModEntry.cs
  
  core_flow:
    1_init: ModEntry loads on game start
    2_load: LocalizationManager loads all JSON from LOCALIZATION/
    3_patch: Harmony patches intercept game text rendering
    4_translate: TranslationEngine finds Korean translation
    5_display: Translated text displayed to player
  
  layers:
    core:
      path: Scripts/00_Core/
      files:
        ModEntry: 00_00_00_ModEntry.cs - Mod initialization
        TranslationEngine: 00_00_01_TranslationEngine.cs - Tag preservation, lookup
        ScopeManager: 00_00_02_ScopeManager.cs - Screen-based scope
        LocalizationManager: 00_00_03_LocalizationManager.cs - JSON loading
        QudKREngine: 00_00_99_QudKREngine.cs - Korean font, Josa
    
    patches:
      path: Scripts/02_Patches/
      subfolders:
        00_Core: Low-level (ScreenBuffer, Steam)
        10_UI: UI screens (Options, CharGen, Inventory, Tutorial)
        20_Objects: Object/Creature names
    
    utils:
      path: Scripts/99_Utils/
      purpose: Translation helpers, CharGen utils, StructureTranslator

# ============================================================================
# DATA STRUCTURE (Translation JSON)
# ============================================================================
data:
  root: LOCALIZATION/
  
  categories:
    CHARGEN:
      purpose: Character creation
      key_files: [genotypes.json, subtypes.json, castes.json, callings.json]
    
    GAMEPLAY:
      purpose: In-game content
      subfolders:
        MUTATIONS: 81 files (Physical, Mental, Defects, Morphotypes)
        TUTORIAL: 6 files (step-by-step tutorials)
      root_files: [messages.json, skills.json, factions.json]
    
    OBJECTS:
      purpose: Items and creatures (57 files, 321+ entries)
      creatures: animals/, humanoids/, insects/, oozes/, plants/, robots/
      items: weapons/, armor/, consumables/, artifacts/, tools/, ammo/, books/
    
    UI:
      purpose: Common UI elements
      key_files: [common.json, options.json, display.json]

  json_formats:
    simple: '{"English Text": "ÌïúÍµ≠Ïñ¥ Î≤àÏó≠"}'
    structured: '{"BlueprintId": {"names": {}, "description_ko": ""}}'

# ============================================================================
# DANGER ZONES (Never do these!)
# ============================================================================
danger:
  never_translate_directly:
    - AttributeDataElement.Attribute: Game uses Substring(0,3)
    - ChoiceWithColorIcon.Id: Used in selection logic
  
  color_tags:
    rule: Never include in translation JSON - auto-restored by engine
    bad: '{"{{c|u}} text": "{{c|u}} Î≤àÏó≠"}'
    good: '{"{{c|u}} text": "Î≤àÏó≠"}'

# ============================================================================
# KEY PATTERNS
# ============================================================================
patterns:
  translation:
    simple: TranslationEngine.TryTranslate(text, out result)
    category: LocalizationManager.TryGetAnyTerm(key, out value, "cat1", "cat2")
    structured: StructureTranslator.GetTranslationData("Name", "MUTATIONS")
  
  harmony_postfix: |
    [HarmonyPostfix]
    static void Method_Postfix(ref string __result) {
        if (TranslationEngine.TryTranslate(__result, out var tr))
            __result = tr;
    }

# ============================================================================
# TOOLS & COMMANDS
# ============================================================================
commands:
  validate: python3 tools/project_tool.py
  commit: bash tools/quick-save.sh
  deploy: bash tools/sync-and-deploy.sh
  session_save: python3 tools/session_manager.py save "description"
  session_handoff: python3 tools/session_manager.py handoff
  full_workflow: python3 tools/session_manager.py save && python3 tools/project_tool.py && bash tools/quick-save.sh

  debug_wishes:
    kr_reload: Reload JSON without restart
    kr_check: Check translation for blueprint
    kr_stats: Show statistics
    kr_untranslated: List untranslated in zone

# ============================================================================
# DOCUMENTATION
# ============================================================================
docs:
  ai_instructions: .github/copilot-instructions.md
  todo: Docs/en/reference/03_TODO.md
  changelog: Docs/en/reference/04_CHANGELOG.md
  error_log: Docs/en/reference/05_ERROR_LOG.md
  session_state: Docs/SESSION_STATE.md

# ============================================================================
# QUICK START (For AI)
# ============================================================================
quick_start:
  new_session:
    1: Read this file (CONTEXT.yaml)
    2: Check Docs/SESSION_STATE.md for recent work
    3: Read TODO for pending tasks
  
  add_translation:
    1: Find JSON in LOCALIZATION/appropriate_folder/
    2: Add {"English": "ÌïúÍµ≠Ïñ¥"}
    3: Run python3 tools/project_tool.py
  
  add_patch:
    1: Find class in Assets/core_source/
    2: Create patch in Scripts/02_Patches/
    3: Use HarmonyPostfix pattern
  
  end_session:
    1: python3 tools/session_manager.py save "work done"
    2: python3 tools/project_tool.py
    3: bash tools/quick-save.sh

# ============================================================================
# CURRENT STATUS (Auto-updated by session_manager.py)
# ============================================================================
status:
  translations: 1377
  mutation_files: 81
  object_files: 57
  build: passing
  last_commit: 85c314e
  last_updated: 2026-01-22T12:27:29.751111
  
  progress:
    phase1_stabilization: 100%
    phase2_gameplay: 75%
    phase3_optimization: 0%
    phase4_community: 0%
  
  pending:
    - "Game Test: Message Log (P2-01)"
    - "Game Test: Attribute Screen (ERR-017 fix)"
  
  recent_work:
    - "CONTEXT.yaml ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏ Í∏∞Îä• ÏàòÏ†ï ÏôÑÎ£å"